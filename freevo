#!/bin/sh

# freevo - the main entry point to the whole suite of applications
#
# $Id$
#

# Is runapp present? If not it needs to be compiled
if ! test -a runapp ; then
    echo ./runapp not found! You must compile freevo, see INSTALL.
    exit
fi

# First check if the runtime is installed
if test -a ../runtime/freevo_rt ; then

    # Prevent the linker from using other libraries than the ones
    # in freevo_rt
    export LD_PRELOAD=`cat ../runtime/preloads`

    # Execute using the runtime:
    echo "Using the Freevo runtime (../runtime)"
    
    # Start the lirc remote control app if the device is present
    if test -S /dev/lircd ; then
        echo Found a lirc device, starting the remote control daemon
        ../runtime/freevo_rt rc_client/remote.py --remote=lirc /dev/null 2> /dev/null &
    fi
    
    # Start the main freevo application
    ../runtime/freevo_rt main.py $*

    # Freevo exited, make sure all children are killed
    sleep 1
    killall -9 ../runtime/freevo_rt 2&> /dev/null
    exit
fi

echo Runtime not found, starting using Python and the startup control task.

python startup.py $*
