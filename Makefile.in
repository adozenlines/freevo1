#
# Freevo main makefile
# 
# $Id$
#

CC=gcc

SUBDIRS = matrox_g400 rc_client osd_server

all: subdirs runapp

x11: all osds_x11

sdl: all osds_sdl

.PHONY: all subdirs x11 osd_x1 $(SUBDIRS) clean release install

osds_x11:
	cd osd_server ; $(MAKE) osds_x11

osds_sdl:
	cd osd_server ; $(MAKE) osds_sdl

runapp:
	$(CC) -o runapp runapp.c -DRUNAPP_LOGDIR=\"/var/log/freevo\"

cdrom.so:
	$(CC) -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -fPIC -I/usr/include/python2.2 -c cdrommodule.c -o cdrommodule.o
	$(CC) -shared cdrommodule.o -o cdrom.so

subdirs: $(SUBDIRS)

$(SUBDIRS):
	$(MAKE) -C $@

clean:
	-rm -f *.pyc *.o log_main_out log_main_err log.txt runapp cdrom.so cdrommodule.o
	cd matrox_g400 ; make clean
	cd rc_client ; make clean
	cd osd_server ; make clean


# XXX Real simple install procedure for now, but freevo is so small it doesn't really
# XXX matter
install: all
	-mv /usr/local/freevo /usr/local/freevo_old_`date +%Y%m%d_%H%M%S`
	-rm -rf /usr/local/freevo
	-mkdir /usr/local/freevo

	-mkdir -p /var/log/freevo
	chmod ugo+rwx /var/log/freevo

	-mkdir -p /var/cache/freevo
	chmod ugo+rwx /var/cache/freevo

	-mkdir -p /var/cache/xmltv/logos
	chmod -R ugo+rwx /var/cache/xmltv

	cp -r * /usr/local/freevo
